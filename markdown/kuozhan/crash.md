# Crash

在开发中有那些会导致 Crash

内存问题、线程问题

应用逻辑的 Bug

- SEGV: (Segmentation Violation，段违例)，无效内存地址，比如说空地址，未初始化地址，栈溢出等

- SIGABRT: 收到 Abort 信号，可能自身调用 abort() 或者收到外部发送过来的信号

- SIGBUS: 总线错误。与 SIGSEGV 不同的是，SIGSEGV 访问的是无效地址（比如虚存映射不到物理内存），而 SIGBUS 访问的是有效地址，但总线访问异常（比如地址对齐问题）

- SIGILL: 尝试执行非法的指令，可能不被识别或者没有权限

- SIGFPE: Floating Point Error，数字计算相关问题（可能不限于浮点计算），比如除零操作

- SIGPIPE: 管道另一端没有进程接手数据；常见的崩溃原因基本都是代码逻辑问题或资源问题，比如数组越界，访问野指针或者资源不存在，或资源大小写错误等

违反 iOS 系统规则产生 crash 的三种类型

- 内存报警闪退

当 iOS 检测到内存过低时，它的 VM 系统会发出低内存警告通知，尝试回收一些内存；如果情况没有得到足够的改善，iOS 会终止后台应用以回收更多内存。最后，如果内存还是不足，那么正在运行的应用可能会被终止掉。在 Debug 模式下，可以主动将客户端执行的动作逻辑写入一个 log 文件中，这样程序童鞋可以将内存预警的逻辑写入该 log 文件，当发生如下截图中的内存报警时，就是提醒当前客户端性能内存吃紧，可以通过 Instruments 工具中的 Allocations 和 Leaks 模块库来发现内存分配问题和内存泄露问题

- 响应超时

当应用程序对一些特定的事件（比如启动、挂起、恢复、结束）响应不及时，苹果 Watchdog 机制会把应用程序干掉，并生成一份相应的 crash 日志

- 用户强制退出

一看 "用户强制退出"，首先可能想到的双击 Home 键，然后关闭应用程序。不过这种场景一般是不会产生 crash 日志的，因为双击 Home 键后，所有的应用程序都处于后台状态，而 iOS 随时都有可能关闭后台程序，当应用阻塞界面并停止响应时这种场景才会产生 crash 日志。这里指的 "用户强制退出" 场景，是稍微比较复杂点的操作: 先按住电源键，直到出现 "滑动关机" 的界面时，再按住 Home 键，这时候当前应用程序会被终止掉，并且产生一份相应事件的 crash 日志

### 如何获取崩溃信息

1. 通过 iTunes 同步设备数据到电脑上 ~/Library/Logs/CrashReporter/MobileDevice/ 将崩溃日志下载下来
2. Xcode 连接设备 Device -> Device Logs 获取设备日志
3. 对于已提交到 App Store，可以从 iTunes Connect 获取到用户的崩溃日志，Manage Your Applications，点击相应的应用，View Detail，Crash Reports
4. 使用第三方 SDK，友盟，Bugly
5. iPhone 崩溃日志分析 Symbolicatecrash 分析工具，通过崩溃日志和应用对应的 .dSYM 文件定位崩溃位置
