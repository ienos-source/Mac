# 图片缓存

```
{
    Manager 调度各个模块
    // 多级缓存提高效率
    Memory 内存，图片缓存
    Disk 磁盘处理
    Network 网络
    Code Manager
    {
      图片解码
      图片压缩/解压缩
    }
}
```

### 读写

- 以图片 URL 的单向 Hash 值作为 Key

开始 -> 内存是否命中 -> 磁盘是否命中 -> 网络下载

### 内存设计

- 存储 Size

- 淘汰策略

  - 先进先出
  - LRU（30 分钟内是否使用过），定时检查、提高检查触发频率（每次进行读写、前后台切换）注意开销问题

### 磁盘设计

读取效率低、内存大

- 存储方式

- 大小限制（如 100MB）

- 淘汰策略（某一图片存储时间距今已超过 7 天）

### 网络设计

- 网络请求最大并发量

- 请求超时策略

- 请求优先级

### 图片解码

- 应用策略模式对不同图片格式进行解码

- 在哪个阶段做图片解码处理？磁盘读取后，网络请求返回后

### 线程处理

```

Manager - Memory Cache - Disk Cache - Network Download

      memory result

```
