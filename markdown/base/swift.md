# Swift

### Struct 和 Class 的区别

- struct 值类型
- class 引用类型

### Swift

是一种高性能的语言，默认是内存安全

Swift 和 OC 语言的对比，

在 OC 语言中，使用 Message 策略，选择器向接收器发送消息，编译阶段无法得知接收器对象或类是否有对应的方法，仅将自定义的面向对象类型编译生成对应的运行时类型，程序运行阶段，运行时系统根据对象的 isa 指针找到对象所属的类结构体，然后通过结合类中的缓存方法列表指针和虚寒暑表指针进行查找选择器对应的 SEL 选择器类型变量，如果找到则根据 SEL 变量对应的 IMP 指针找到方法实现。若找不到对应的方法，则会启动消息转发机制，如果仍然失败，则抛出运行时异常。缺点是消耗大量资源。

Swift 运行时的一个对象在调用方法时，编译器会使用类似 C++ 的虚表 vtable 来查找方法实现，vtable 是组成 Swift 类的一个存储该类所有方法的函数指针的数组，运行时可以简单地通过下标访问这些函数指针

Swift 编译优化，如果一个方法没有具体实现，会直接跳过；如果一个对象 obj 在多次循环里面重复调用同一个方法，在 Swift 中编译器不会分配堆内存给 obj 进行初始化，相反，编译器会将 objc 创建在栈上

### 静态与动态

Swift

- 静态: 要调用的函数地址在编译时确定，因此此类调用的开销类似于 C 函数调用，这种机制用于 private 或者 final 类的方法调用调度

- 动态: 它允许实现 OOP 的多态概念，要调用的函数地址在运行时确定，Swift 有两个子类型:
  - Obj-C - 你已经在问题中描述过，当对象从 NSObject 或者调用方法具有 @objc 前缀时使用此机制
  - 基于虚拟表（如 C++ 中）， 有类似的见证表。它在方法调用调度期间所做的只是单个算术运算 - 根据基类见证表中的函数偏移量和对象类见证表位置计算实际函数地址，因此，与 Objc-C 相比，相对迅速。 method_implementation = object->class.vtable[indexOfMyMethod]

  
